--- 
title: "Energy and Human Development"
author: "Antonin Vidon and Jannik Wiedenhaupt"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
---
--- 
title: "Energy and Human Development"
author: "Antonin Vidon and Jannik Wiedenhaupt"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
---
```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```

# Introduction

The effect of energy consumption on economic growth is a wide area of research and teaches us that energy is in fact one of the most important driver of economic development. In our study, instead of considering the raw economic growth, we weigh human development and its core components: long and healthy life, level of education and standard of living (GDP per capita and related). We put to the test some intuitive insights between energy consumption and human development. 

<!--chapter:end:index.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data sources


<!--chapter:end:02-data.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data transformation

<!--chapter:end:03-cleaning.Rmd-->

---
output:
  html_document: default
  pdf_document: default
---
```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Missing values

```{r, echo=FALSE, warning=FALSE}
library(dplyr)
library(tidyverse)
library(patchwork)
library(Lock5withR)
library(ggpubr)
source("R/plot_missing_patterns.R")
```

In this chapter, we analyze the missing data in our four primary data sets on energy consumption, GDP, life expectancy, years of schooling, and life expectancy.

## Energy consumption

```{r}
energy_data <- read.csv("data/owid_energy_data.csv", header=TRUE, stringsAsFactors=FALSE)
df_energy <- as.data.frame(energy_data)
selected_columns <- c("iso_code", "country", "year","consumption")
df_energy_sel <- df_energy %>% 
  select(contains(selected_columns)) %>%
  select(-contains(c("_per_capita", "_pct", "_change"))) %>%
  subset(year >= 1990) %>%
  rename("fossil_fuel" = "fossil_fuel_consumption", 
         "hydro" = "hydro_consumption", 
         "low_carb" = "low_carbon_consumption", 
         "nuclear" = "nuclear_consumption", 
         "other_renew" = "other_renewable_consumption", 
         "renew" = "renewables_consumption", 
         "solar" = "solar_consumption", 
         "wind" = "wind_consumption", 
         "coal" = "coal_consumption", 
         "gas" = "gas_consumption", 
         "oil" = "oil_consumption", 
         "biofuel" = "biofuel_consumption", 
         "primary" = "primary_energy_consumption")
  
plot_missing_parameters(df_energy_sel, use_counts = FALSE, max_100 = FALSE, 
                        ticks_angle = 45, ticks_size = 9, complete_cases_size = 3.5, complete_cases_hjust = 0)
```
We can see that about 40% of rows are missing almost all variables. This might become a problem when comparing countries over time as this might suggest that some countries have only little data for a limited number of years.
However, about 35% of rows are complete, in that the energy mix can be fully analyzed. The remaining 30% of rows also miss a high share of variables with some exception for oil, biofuel, and primary energy consumption. The reasons for this will need to be examined.

Now, we calculate the share of all missing data to the overall dataset to get a sense of the magnitude.
```{r}
# Calculate share of missing data in total
perc_missing <- round(sum(is.na(df_energy_sel)) * 100 / prod(dim(df_energy_sel)), 1)
cat(perc_missing, "% of cell values is missing", sep="")
```

With such a high value, we know that we will need to reduce our analysis to some subset of rows to make many meaningful analyses. Second, we calculate the missing data on a column basis.
```{r}
# Calculate share of missing data per column
df_energy_na <- as.data.frame(round(colSums(is.na(df_energy_sel)) / nrow(df_energy_sel) * 100, 1)) %>% 
  rename(perc_na = 1) %>%
  mutate(variable = rownames(.)) %>%
  arrange(-perc_na)
ggplot(df_energy_na, aes(x=reorder(variable, perc_na), y=perc_na)) + 
  geom_col() +
  labs(x="Variable", y="Missing data (in percent)", title="Missing data per column") +
  coord_flip()
```

We look at the same visualization on a by-region basis. To identify a country's region, we merge the energy data set with the worldbank data set on countries.
```{r}
df_by_country <- df_energy_sel %>% mutate(missing_perc = rowSums(apply(is.na(df_energy_sel), 2, as.numeric))/ncol(df_energy_sel))
df_by_country <- df_by_country %>% filter(iso_code != "") %>% select(c(iso_code, country, year, missing_perc))
df_by_country <- left_join(df_by_country, df_country_info, by = "iso_code") %>%
  select(c(iso_code, country, year, missing_perc, Region, IncomeGroup)) %>%
  arrange(-missing_perc)
df_by_region <- df_by_country %>%
  select(c(Region, year, missing_perc)) %>%
  group_by(Region, year) %>%
  summarise(missing_perc = mean(missing_perc))
df_by_region_order <- df_by_region %>%
  group_by(Region) %>%
  summarise(mean_missing = mean(missing_perc)) %>%
  arrange(desc(mean_missing), Region)
df_by_region$Region <- factor(df_by_region$Region, levels = df_by_region_order$Region)
plt_available_years_by_region <- ggplot(df_by_region, aes(x=year, y=missing_perc)) + 
  geom_col() + 
  ylim(0, 1) +
  facet_wrap(~Region) +
  labs(x="Year", y="Missing data (in percent)", title="Missing Data by Geographic Region")
plt_available_years_by_region
```

On a region-basis, we can see that Sub-Saharan Africa and Latin America have the most missing data, while Europe & central Asia, as well as North America have the least missing values. For all regions, data availability remains largely constant over time with a high spike in 2020. This is likely due to recency and that some data is not finally collected yet. We also see that because of the merge some countries were not matched with a region in the last graph "NA". Looking at these countries individually, we will be able to match them with the fitting region.

Now we look at the missing data on a by-country basis.
```{r, fig.height=30, fig.width=15}
df_by_country_order <- df_by_country %>%
  group_by(country, Region) %>%
  summarise(sum_missing = sum(missing_perc))
df_by_country_order <- df_by_country_order %>% arrange(desc(sum_missing), Region)
order_country <- df_by_country_order$country
df_by_country$country <- factor(df_by_country$country, levels = order_country)
plt_available_years_by_country <- ggplot(df_by_country, aes(x=year, y=missing_perc, color=Region)) + 
  geom_col() + 
  ylim(0, 1) +
  facet_wrap(~country, ncol = 7) +
  theme(axis.text.x = element_text(angle = 20, hjust = 1, size = 7)) +
  labs(x="Year", y="Missing Data (in percent)", title="Missing Data by Country and Region")
plt_available_years_by_country
```

Looking at the missing data by country, it becomes clear that many countries missing specific variables over the entire time frame. The data availability is also constant inside the previously looked at regions. While the data availability in European and North American countries is largely consistent, the countries in East Asia & Pacific and Latin America vary widely. Some of them are among the best in terms of data availability while others are among the worst. We predict a strong correlation with GDP which will be test later.


## GDP per capita

```{r}
gdp_per_capita <- read.csv("data/gdp_per_capita.csv", skip = 4, check.names = FALSE)
relevant_years <- as.character(1990:2019)
gdp_per_capita <- gdp_per_capita %>%
  select("Country Name", relevant_years)
mygdp_per_capita <- gdp_per_capita
names(mygdp_per_capita) <- c("Country", substring(names(mygdp_per_capita)[1:length(relevant_years) + 1], 0, 4))
plot_missing_parameters(data = mygdp_per_capita, use_counts = FALSE, max_100 = FALSE, 
                        ticks_angle = 90, ticks_size = 7.5, complete_cases_size = 2, complete_cases_hjust = 0.05, y_ticks_size = 6)
```

## Life expectancy

```{r}
un_life_data <- read.csv("data/life_expectancy.csv", skip = 4, check.names = FALSE)
relevant_years <- as.character(1990:2019)
un_life_data <- un_life_data %>%
  select("Country Name", relevant_years)
myun_life_data <- un_life_data
names(myun_life_data) <- c("Country", substring(names(myun_life_data)[1:length(relevant_years) + 1], 0, 4))
plot_missing_parameters(data = myun_life_data, use_counts = FALSE, max_100 = FALSE, 
                        ticks_angle = 90, ticks_size = 7.5, complete_cases_size = 3, complete_cases_hjust = 0.05)
```

## Years of schooling

```{r}
un_years_of_schooling <- read.csv("data/un_years_of_schooling.csv", skip = 6, check.names = FALSE)
relevant_years <- as.character(1990:2019)
un_years_of_schooling <- un_years_of_schooling %>%
  select("Country", "HDI Rank", relevant_years) %>%
  mutate_at(relevant_years, as.numeric) %>%
  mutate_at("HDI Rank", as.numeric)
myun_years_of_schooling <- un_years_of_schooling
#names(myun_years_of_schooling) <- c("cy", "hdi", substring(names(myun_years_of_schooling)[1:length(relevant_years) + 1], 0, 4))
plot_missing_parameters(data = myun_years_of_schooling, use_counts = FALSE, max_100 = FALSE, 
                        ticks_angle = 90, ticks_size = 7.5, complete_cases_size = 3, complete_cases_hjust = 0.05)
```

<!--chapter:end:04-missing.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Results

<!--chapter:end:05-results.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Interactive component



<!--chapter:end:06-interactive.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Conclusion


<!--chapter:end:07-conclusion.Rmd-->

