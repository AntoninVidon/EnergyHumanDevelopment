--- 
title: "Energy and Human Development"
author: "Antonin Vidon and Jannik Wiedenhaupt"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
---
--- 
title: "Energy and Human Development"
author: "Antonin Vidon and Jannik Wiedenhaupt"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
---
```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```

# Introduction

The effect of energy consumption on economic growth is a wide area of research and teaches us that energy is in fact one of the most important driver of economic development. In our study, instead of considering the raw economic growth, we weigh human development and its core components: long and healthy life, level of education and standard of living (GDP per capita and related). We put to the test some intuitive insights between energy consumption and human development.

<!--chapter:end:index.Rmd-->


# Data sources

Placeholder


### Population {.unlisted .unnumbered}
### GDP {.unlisted .unnumbered}
### HDI {.unlisted .unnumbered}
### Life expectancy {.unlisted .unnumbered}
### Years of schooling {.unlisted .unnumbered}
### Energy consumption {.unlisted .unnumbered}
### Country info {.unlisted .unnumbered}

<!--chapter:end:02-data.Rmd-->


# Data transformation

Placeholder


## Selecting the time range

<!--chapter:end:03-cleaning.Rmd-->


# Missing values

Placeholder


## Missing values for the merged dataframe
## Energy consumption
## GDP
## Life expectancy
## Years of schooling

<!--chapter:end:04-missing.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Results

```{r, echo=FALSE, warning=FALSE}
library(dplyr)
library(tidyverse)
library(patchwork)
library(Lock5withR)
library(ggpubr)
library(stringr)
library(esquisse)
library(gganimate)
library(ggrepel)
library(GGally)
library(parcoords)
library(tools)
library(grid)
source("R/plot_missing_patterns.R")
```


```{r echo=FALSE, warning=FALSE}
# Load Data
master_df <- read.csv(file = "data/master.csv")
```

## Is an energy mix oriented towards renewable sources associated with good human development indicators? 
```{r}
data_country_info <- read.csv("data/worldbank_country_info.csv", header=TRUE, stringsAsFactors=FALSE, encoding = "UTF-8")
df_country_info <- as.data.frame(data_country_info)
df_country_info <- as.data.frame(data_country_info) %>% 
  rename(c(ISO_code = "X.U.FEFF.iso_code", region="Region", income_group="IncomeGroup"))
df_country_info <- df_country_info %>% select(c("ISO_code", "region", "income_group"))

master_df <- left_join(master_df, df_country_info, by = "ISO_code")
```

```{r, fig.width=8, fig.height=3}
par(mfrow=c(1,2))

graph_df <- master_df[master_df$year==2019,]
p1 <- ggplot(graph_df, aes(x=renew/primary*100, y=HDI)) +
  geom_point(aes(color = region)) +
  geom_smooth(method="lm") +
  theme_light() + 
  theme(legend.position="none") +
  geom_text(
    label=graph_df$country, 
    nudge_x = 0, nudge_y = 0.02,
    size = 3,
    check_overlap = T
  ) +
  labs(x="Renewable energy consumption to overall energy consumption(in %)", color="Region")

p2 <- ggplot(graph_df, aes(x=renew/population*1000000000, y=HDI)) +
  geom_point(aes(color = region)) +
  geom_smooth(method="lm") +
  theme_light() + 
  theme(legend.position="none") +
  geom_text(
    label=graph_df$country, 
    nudge_x = 0, nudge_y = 0.02,
    size = 3,
    check_overlap = T
  ) +
  scale_x_log10() +
  labs(x="Renewable energy consumption per capita (in MWh)", y="", color="Region")

get_only_legend <- function(plot) { 
  plot_table <- ggplot_gtable(ggplot_build(plot))  
  legend_plot <- which(sapply(plot_table$grobs, function(x) x$name) == "guide-box")
  legend <- plot_table$grobs[[legend_plot]] 
  return(legend)  
}

p1_legend <- ggplot(graph_df, aes(x=renew/primary*100, y=HDI)) +
  geom_point(aes(color = region)) +
  theme_light() +
  theme(legend.position = "bottom") +
  labs(color="Region")

legend <- get_only_legend(p1_legend)
combined_plot <- gridExtra::grid.arrange(p1, p2, ncol=2)
gridExtra::grid.arrange(combined_plot, legend, nrow=2, heights = c(9, 2), top = textGrob("Relation of HDI Score to Renewable Energy Consumption"))
```
<u>Observations:</u>

- Positive correlation between both relative renewable energy and HDI score as well as absolute renewable energy and HDI score.
- Stronger correlation between absolute renewable energy consumption because there is also a strong positive correlation between human development and energy consumption independent of the energy source
- Norway and Iceland are far outliers in the renewable energy consumption with 65 to nearly 80% renewables in their energy mix
- Citizens of many countries consume a similar amount of renewable energy but experience varying levels of human development

```{r}
energy_vars <- c("fossil_fuel", "hydro", "low_carb", "nuclear", "other_renew", "renew", "solar", "wind", "coal", "gas", "oil", "biofuel", "primary")

scat_mat_lr <- function(data, mapping, ...){
  p <- ggplot(data = data, mapping = mapping) + 
    geom_point() + 
    geom_smooth(method=lm, fill="blue", color="blue", ...)
  p
}
```

```{r}
energy_vars <- c("fossil_fuel", "hydro", "low_carb", "nuclear", "other_renew", "renew", "solar", "wind", "coal", "gas", "oil", "biofuel")
perct_df <- master_df
perct_df[energy_vars] <- (perct_df[energy_vars] / perct_df$primary) *100

ggpairs(perct_df, columns = c(5, 6, 7, 8, 14), lower = list(continuous = scat_mat_lr))
```

```{r}
min_max_norm <- function(x) {
    (x - min(x)) / (max(x) - min(x))
}
master_normal_df <- replace(master_df,is.na(master_df),0)

master_normal_df <- as.data.frame(lapply(master_normal_df[4:21], min_max_norm))

fit <- lm(HDI ~ fossil_fuel + nuclear + renew, master_normal_df)

summary(fit)
```


## What characterises the countries that have the most renewable energy mix? 
(There is no data on renewable energy available for 91 countries. These countries are mainly in Africa.)

```{r, echo=FALSE}
# What countries have a high share of renewables today?
graph_df <- master_df %>% filter(year==2019 & !is.na(renew))
ggplot(graph_df, aes(x=reorder(country, (renew/primary)), y=renew/primary*100)) +
  geom_col() +
  coord_flip() +
  theme_light() + 
  theme(axis.text = element_text(size = 5)) +
  labs(y="Share of renewable energy (in %)", x="Country")
```
```{r, echo=FALSE}
# How does the share of renewable energy change in different countries?
graph_df <- master_df %>% 
  filter(!is.na(renew))
graph_df$income_group[graph_df$country=="Venezuela"] <- "Lower middle income"
graph_df <- graph_df %>%
  group_by(income_group, year) %>% 
  summarise(renew = sum(renew), primary = sum(primary))

graph_df$label <- NA
graph_df$label[which(graph_df$year == max(graph_df$year))] <- graph_df$income_group[which(graph_df$year == max(graph_df$year))]
ggplot(graph_df, aes(x=year, y=renew/primary*100, group=income_group, color=income_group)) +
  geom_line() +
  theme_light() + 
  theme(legend.position="none") +
  labs(x="Year", y="Share of renewable energy (in %)") +
  geom_label_repel(aes(label = label), nudge_x = 1, na.rm = TRUE)
```

```{r, echo=FALSE}
# What is the energy mix of the most renewable and the least renewable countries?
distinct_energy_vars <- c("hydro", "nuclear", "solar", "wind", "coal", "gas", "oil", "biofuel", "other_renew")
graph_df <- master_df %>% filter(year==2019)
graph_df <- graph_df %>% arrange(desc(renew/primary)) %>% slice(1:10) %>% select(-c("primary", "fossil_fuel", "renew"))
graph_df <- graph_df %>% pivot_longer(distinct_energy_vars, names_to = "energy")
graph_df$value_per_capita <- graph_df$value / graph_df$population
graph_df$energy <- sub("other_renew", "Other Renewables", graph_df$energy)
graph_df$energy <- toTitleCase(graph_df$energy)
levels <- names(sort(tapply(graph_df$value_per_capita, graph_df$energy, sum)))

ggplot(graph_df, aes(x=reorder(country, -value_per_capita*1000000), y=value_per_capita*1000000, fill=factor(energy, levels=levels))) +
  geom_bar(stat="identity") +
  theme_light() + 
  theme(axis.text = element_text(angle = 45, vjust = 0, hjust = 1)) +
  scale_fill_manual(values=c("#eabc35", "#8d9e2b", "#7cabcb", "#645f55", "#c0b879", "#d0d890", "#b18781", "black", "#1e7991")) +
  labs(y="Energy mix per capita (in MWh)", x="Country", fill="Energy source")
```
<u>Observations:</u>

- The countries highest share of renewable energy in their energy 
- Stronger correlation between absolute renewable energy consumption because there is also a strong positive correlation between human development and energy consumption independent of the energy source
- Norway and Iceland are far outliers in the renewable energy consumption with 65 to nearly 80% renewables in their energy mix
- Citizens of many countries consume a similar amount of renewable energy but experience varying levels of human development

```{r}
# Calculate average energy mix of top 10 most renewable countries and compare to the rest of the world
perct_graph_df <- master_df
perct_graph_df[energy_vars] <- (perct_df[energy_vars] / rowSums(perct_df[distinct_energy_vars])) *100
perc_df_2019 <- perct_graph_df %>% filter(year==2019)
top_ten_df <- perc_df_2019 %>% arrange(desc(renew/primary)) %>% slice(1:10) %>% select(-c("primary", "fossil_fuel", "renew"))
top_ten_df <- top_ten_df %>% pivot_longer(distinct_energy_vars, names_to = "energy")
top_ten_df <- top_ten_df %>% group_by(energy) %>%
  summarise(value = mean(value))
top_ten_df$name <- "Top Ten"

average_df <- perc_df_2019 %>% arrange(desc(renew/primary)) %>% slice(11:nrow(.)) %>% select(-c("primary", "fossil_fuel", "renew"))
average_df <- average_df %>% pivot_longer(distinct_energy_vars, names_to = "energy") %>% drop_na(value)
average_df <- average_df %>% group_by(energy) %>%
  summarise(value = mean(value))
average_df$name <- "Rest average"


compare_df <- rbind(top_ten_df, average_df)
compare_df$energy <- sub("other_renew", "Other Renewables", compare_df$energy)
compare_df$energy <- toTitleCase(compare_df$energy)

ggplot(compare_df, aes(x=name, y=value, fill=factor(energy, levels=levels))) +
  geom_bar(stat="identity") +
  theme_light() + 
  scale_fill_manual(values=c("#eabc35", "#8d9e2b", "#7cabcb", "#645f55", "#c0b879","#d0d890", "#b18781", "black", "#1e7991")) +
  labs(y="Energy mix (in %)", x="Class", fill="Energy source")
```

```{r}
#interactive_plot <- master_df[master_df$year==2019,] %>% 
#  select (-c("ISO_code","year", "population", "hydro", "nuclear", "solar", "wind", "coal", "gas", "oil", "biofuel"))  %>%
#  parcoords(rownames = FALSE, brushMode = "1d-axes", reorderable = TRUE, queue = T,color = list(colorBy = "region"), withD3=TRUE)

#interactive_plot
```




### Ideas:
- outlier analysis
- filter on GDP or population to make trends appear
- cluster countries by energy mix
- development of different income areas



On the other hand, how does the production of coal and gas energy leading to more pollution might foster and hinder human development at the same time?
- countries might consume other energy than they produce
- 



<!--chapter:end:05-results.Rmd-->


# Results Antonin's part

Placeholder


## How is the increase in energy consumption boosting the education system in order to cope with the industrial ”boom” generated by rapid economic growth? 

<!--chapter:end:06-results.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Interactive component

```{r, echo=FALSE, warning=FALSE}
library(dplyr)
library(tidyverse)
library(parcoords)
```

```{r echo=FALSE, warning=FALSE}
# Load Data
master_df <- read.csv(file = "data/master.csv")
```

```{r interactive}
graph_df <- master_df %>% 
  filter(year == 2019) %>%
  select (-c("ISO_code","year", "population", "hydro", "nuclear", "solar", "wind", "coal", "gas", "oil", "biofuel")) %>% 
  parcoords(rownames = FALSE,brushMode = "1d-axes",reorderable = TRUE, queue = T, withD3=TRUE)

graph_df
```


<!--chapter:end:07-interactive.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Conclusion

<!--chapter:end:08-conclusion.Rmd-->

