# Results Antonin's part

```{r, echo=FALSE, warning=FALSE}
# load packages
library(dplyr)
library(tidyverse)
library(rworldmap)
library(rgdal)
library(leaflet)
library(gganimate)
library(leaflet)
library(rgdal)
library(plotly)
```


```{r echo=FALSE, warning=FALSE}
# load master data
master_df <- read.csv(file = "data/master.csv")

# load country info data
df_country_info <- read.csv("data/worldbank_country_info.csv", header=TRUE, stringsAsFactors=FALSE, encoding = "UTF-8") %>%
    rename(c(ISO_code = "X.U.FEFF.iso_code", region="Region", income_group="IncomeGroup")) %>%
    select(c("ISO_code", "region", "income_group"))
```

## Cross directional causality btw. EC, GDP and YOS

The acronyms EC, GDP and YOS will be used to refer to energy consumption, gross domestic product and years of schooling respectively.

### Energy consumption fuels economic prosperity {.unlisted .unnumbered}

Analyzing the impact of energy consumption on GDP and mean years of schooling is not that easy as the three variables suffer from cross directional causality.
The intuition suggests a **high correlation between energy consumption and GDP**. Indeed, most economies are highly energy dependent and many production and consumption activities involve energy as a central input. 


```{r, , fig.height=7, fig.width = 7}
# plot GDP per capita vs primary energy consumption per capita in 2019
master_df %>%
    left_join(df_country_info, by = "ISO_code") %>%
    filter(year == 2019) %>%
    ggplot(aes(x=primary/population, y=GDP/population)) +
    geom_point(aes(color = region, size = population, label = country)) +
    geom_smooth(method="lm", color = "black") +
    theme_light() +
    scale_x_log10(labels = function(l) {trans = l * 1000}) +
    scale_y_log10(labels = function(l) {trans = l / 1000}) +
    geom_text(
      aes(label=country), vjust = 2,
      size = 3,
      check_overlap = T
    ) +
    ggtitle("GDP per cap. vs. Primary energy consumption per cap. in 2019") +
    xlab("Primary energy consumption per capita (MWh)") + 
    ylab("GDP per capita (k$)") +
    theme_classic() +
    theme(legend.position="bottom", legend.box = "vertical", 
          panel.grid.major.x = element_line( size=.1, color="gray" ),  
          panel.grid.major.y = element_line( size=.1, color="gray" )) +
    guides(colour = guide_legend(order = 1),
            size = guide_legend(order = 2),
           colour = guide_legend(override.aes = list(size=4)))
```


This graph emphasizes the intuitive idea that **energy is required to stimulate growth**. More consumption generally results in an increase in the economic output.

* * *

### Parallel increase of EC and YOS in economic growth  {.unlisted .unnumbered}

As a country benefits from economic prosperity with a higher GDP per capita, this one might allocate more resources to education to foster the formation of human capital. This would **enhance the schooling system and lead to the increase of the mean year of schooling** for a given cohort.


```{r}
# plot GDP per capita vs primary energy consumption per capita in 2019
master_df %>%
    filter(country %in% c("Brazil", "Russia", "India", "China")) %>%
    ggplot(aes(x=primary/population, y=years_of_schooling, group = country, colour = country)) +
    geom_point(aes(label = year)) +
    geom_path(size = 1,
              arrow = arrow(type = "open", angle = 30, length = unit(0.15, "inches"))) +
    theme_light() +
    scale_x_log10(labels = function(l) {trans = l * 1000}) +
    ggtitle("Mean years of schooling vs. Primary energy consumption per cap. \n for BRIC countries over 1990-2019") +
    xlab("Primary energy consumption per capita (MWh)") + 
    ylab("Expected years of schooling at birth (years)") +
    theme_classic() +
    theme(legend.position="bottom", legend.box = "vertical", 
          panel.grid.major.x = element_line( size=.1, color="gray" ),  
          panel.grid.major.y = element_line( size=.1, color="gray" )) +
    guides(colour = guide_legend(order = 1),
           colour = guide_legend(override.aes = list(size=4))) +
  scale_colour_discrete(limits = c("Brazil", "Russia", "India", "China"))
```

```{r}
# plot GDP per capita vs primary energy consumption per capita in 2019
master_df %>%
    filter(country %in% c("United States", "Canada", "Japan", "France", "Germany")) %>%
    ggplot(aes(x=primary/population, y=years_of_schooling, group = country, colour = country)) +
    geom_point(aes(label = year)) +
    geom_path(size = 1,
              arrow = arrow(type = "open", angle = 30, length = unit(0.15, "inches"))) +
    theme_light() +
    scale_x_log10(labels = function(l) {trans = l * 1000}) +
    ggtitle("Mean years of schooling vs. Primary energy consumption per cap. \n for most mature countries over 1990-2019") +
    xlab("Primary energy consumption per capita (MWh)") + 
    ylab("Expected years of schooling at birth (years)") +
    theme_classic() +
    theme(legend.position="bottom", legend.box = "vertical", 
          panel.grid.major.x = element_line( size=.1, color="gray" ),  
          panel.grid.major.y = element_line( size=.1, color="gray" )) +
    guides(colour = guide_legend(order = 1),
           colour = guide_legend(override.aes = list(size=4))) +
  scale_colour_discrete(limits = c("United States", "Canada", "Japan", "France", "Germany")) 
  
```

```{r}
# plot GDP per capita vs primary energy consumption per capita in 2019
master_df %>%
    filter(country %in% c("United States", "Canada", "Japan", "France", "Germany", "Brazil", "Russia", "India", "China")) %>%
    mutate(category = if_else(country %in% c("Brazil", "Russia", "India", "China"), "BRIC", "mature")) %>%
    ggplot(aes(x=primary/population, y=years_of_schooling, group = country, colour = category)) +
    geom_point(aes(label = year)) +
    geom_hline(yintercept = 15.0, color = "black", size = 0.5) +
    geom_hline(yintercept = 17.0, color = "black", size = 0.5) +
    geom_path(size = 0.2) +
    theme_light() +
    geom_point(aes(group = seq_along(year))) +
    transition_reveal(year) +
    scale_x_log10(labels = function(l) {trans = l * 1000}) +
    ggtitle("Mean years of schooling vs. Primary energy consumption per cap. \n for BRIC and most mature countries over 1990-2019") +
    xlab("Primary energy consumption per capita (MWh)") + 
    ylab("Expected years of schooling at birth (years)") +
    theme_classic() +
    theme(legend.position="bottom", legend.box = "vertical", legend.title = element_blank(),
          panel.grid.major.x = element_line( size=.1, color="gray" ),  
          panel.grid.major.y = element_line( size=.1, color="gray" )) +
    guides(colour = guide_legend(order = 1),
           colour = guide_legend(override.aes = list(size=4))) +
  scale_color_manual(labels = c("BRIC : Brazil, Russia, India and China", "Mature countries : United States, Canada, Japan, France, Germany"), values=c("black", "#E69F00"))
```

The path towards economic maturity consists of a **simultaneous rise of energy consumption and mean years of schooling**. To become more productive, a country invests in education in order for its proportion of educated workers to increase. On the plot just above, we notice that **the expect years of schooling seems to converge towards a value between 15 and 17 years, value that we observe for mature countries**.

* * *

## Co-movement of energy consumption and HDI

### An overview of HDI in the world {.unlisted .unnumbered}

```{r, echo=FALSE}
# What countries have a high share of renewables today?
# Use 2019 percentage data
graph_df <- master_df

#Read shape file
world_spdf <- readOGR( 
  dsn= paste0(getwd(), "/R/world_shape_file"), 
  layer="TM_WORLD_BORDERS_SIMPL-0.3",
  verbose=FALSE
)

world_spdf@data = data.frame(world_spdf, graph_df[match(world_spdf$ISO3, graph_df$ISO_code),])

# Create a color palette for the map:
mybins <- c(0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1.0)
mypalette <- colorBin( palette="YlGn", domain = graph_df$renew, na.color="#d3d3d3", bins=mybins)

# Display map
leaflet(world_spdf) %>% 
  addTiles()  %>% 
  setView( lat=10, lng=0 , zoom=2) %>%
  addPolygons( 
    fillColor = ~mypalette(HDI), 
    stroke=TRUE, 
    fillOpacity = 0.9, 
    color="white", 
    weight=0.3,
    labelOptions = labelOptions( 
      style = list("font-weight" = "normal", padding = "3px 8px"), 
      textsize = "13px", 
      direction = "auto"
    )
  ) %>%
  addLegend(pal=mypalette, values=~HDI, opacity=0.9, title = "HDI", position = "bottomleft" )
```


* * *

### Segmented analysis of HDI {.unlisted .unnumbered}

The increase of energy consumption of a population generally tends to affect its way of living. The intuition suggests that, in the long-term, consuming more energy is correlated with an improvement of the the human development of a population and hence, an increase of the HDI.


```{r, fig.height=7, fig.width = 7}
# energy consumption per capita threshold for segmented regression
log_pcpc_sep <- 3.5e-5


regression_data_inf <- master_df %>%
    left_join(df_country_info, by = "ISO_code") %>%
    filter(year == 2019, primary/population <= log_pcpc_sep) %>%
    mutate(log_ratio_primary_population = log10(primary/population))

regression_data_sup <- master_df %>%
    left_join(df_country_info, by = "ISO_code") %>%
    filter(year == 2019, primary/population > log_pcpc_sep) %>%
    mutate(log_ratio_primary_population = log10(primary/population))

lm_inf <- lm(data = regression_data_inf, HDI ~ log_ratio_primary_population)
lm_sup <- lm(data = regression_data_sup, HDI ~ log_ratio_primary_population)

r_squared_inf <- summary(lm_inf)$r.squared
r_squared_sup <- summary(lm_sup)$r.squared

# plot HDI vs primary energy consumption per capita in 2019
master_df %>%
    left_join(df_country_info, by = "ISO_code") %>%
    filter(year == 2019) %>%
    ggplot(aes(x=primary/population, y=HDI)) +
    geom_point(aes(color = region, size = population, label = country)) +
    geom_vline(xintercept = log_pcpc_sep, linetype = "dashed") +
    geom_smooth(data = subset(master_df, 2e-6 < primary/population & primary/population < log_pcpc_sep), method="lm", color = "black") +
    geom_smooth(data = subset(master_df, primary/population > log_pcpc_sep), method="lm", color = "black") +
    theme_light() +
    scale_x_log10(labels = function(l) {trans = l * 1000}) +
    scale_y_log10() +
    geom_text(
      aes(label=country), vjust = 2,
      size = 3,
      check_overlap = T
    ) +
    annotate("text", x = 0.00002, y= 0.55, label=paste("R^2 == ", round(r_squared_inf, digits = 2)), parse = T) +
    annotate("text", x = 0.0002, y= 0.55, label=paste("R^2 == ", round(r_squared_sup, digits = 2)), parse = T)  +
    ggtitle("HDI vs. Primary energy consumption per cap. in 2019") +
    xlab("Primary energy consumption per capita (MWh)") + 
    ylab("HDI") +
    theme_classic() +
    theme(legend.position="bottom", legend.box = "vertical", 
          panel.grid.major.x = element_line( size=.1, color="gray" ),  
          panel.grid.major.y = element_line( size=.1, color="gray" )) +
    guides(colour = guide_legend(order = 1),
            size = guide_legend(order = 2),
           colour = guide_legend(override.aes = list(size=4)))
```

There seems to be a **threshold of energy consumption per capita which separates two types of HDI behaviors**. For countries with low level of energy consumption, the **causal relationship between energy consumption and HDI is very strong**, as suggested by the high value of $R^2$. By contrast, there does not seem to be a correlation for countries with high level of energy consumption. Intuitively, the investments made by a country on the verge of becoming wealthier will generally have a **much larger effect on human development** (health system, education).